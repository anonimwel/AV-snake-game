<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Game Cacing punya avril</title>
  <style>
    :root{
      --bg:#f3f4f6; --panel:#ffffff; --text:#0f172a; --accent:#10b981;
    }
    [data-theme="dark"]{ --bg:#0b1220; --panel:#071026; --text:#e6eef8; --accent:#60a5fa; }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,Arial;background:var(--bg);color:var(--text);display:flex;align-items:center;justify-content:center;height:100vh}
    .app{width:960px;max-width:96vw;padding:20px;background:linear-gradient(180deg,rgba(255,255,255,0.03),transparent);border-radius:12px;display:grid;grid-template-columns:1fr 320px;gap:18px;align-items:start}
    .board-wrap{background:var(--panel);padding:16px;border-radius:10px;display:flex;flex-direction:column;align-items:center;box-shadow:0 6px 18px rgba(2,6,23,0.12)}
    canvas{background:linear-gradient(180deg,rgba(0,0,0,0.02),transparent);border-radius:8px;display:block}
    .controls{background:var(--panel);padding:16px;border-radius:10px;height:fit-content;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
    label{display:block;margin-bottom:6px;font-size:13px}
    select,input[type=range],button{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.08);background:transparent;color:var(--text);font-size:14px}
    .row{display:flex;gap:8px;margin-bottom:12px}
    .btn{cursor:pointer;background:var(--accent);color:white;border:none}
    .small{width:48%;}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .title{font-weight:600}
    .theme-toggle{display:flex;align-items:center;gap:8px}
    .sky{position:relative;width:48px;height:48px}
    .sun,.moon{position:absolute;left:50%;transform:translateX(-50%);width:36px;height:36px;border-radius:999px;display:flex;align-items:center;justify-content:center}
    .sun{background:linear-gradient(180deg,#ffd166,#ffb703);bottom:-20px;opacity:0;transition:all 700ms ease}
    .moon{background:linear-gradient(180deg,#94a3b8,#718096);top:6px;transition:all 700ms ease}
    .show-sun .sun{bottom:6px;opacity:1}
    .show-sun .moon{top:80px;opacity:0}
    .info{font-size:13px;margin-top:8px}
    .footer{grid-column:1/-1;margin-top:12px;text-align:center;color:rgba(0,0,0,0.45);font-size:13px}
    @media (max-width:880px){.app{grid-template-columns:1fr;}} 
  </style>
</head>
<body data-theme="dark">
  <div class="app">
    <div class="board-wrap">
      <div class="topbar">
        <div>
          <div class="title">Game Cacing punya avril</div>
          <div style="font-size:13px;color:rgba(0,0,0,0.45)">Pakan: 1 permen ‚Äî setiap termakan bertambah 1</div>
        </div>
        <div class="theme-toggle" id="themeToggleWrap">
          <div class="sky" id="sky">
            <div class="moon" id="moon">üåô</div>
            <div class="sun" id="sun">‚òÄÔ∏è</div>
          </div>
          <button id="themeBtn" class="btn">Mode</button>
        </div>
      </div>
      <canvas id="game" width="600" height="600"></canvas>
      <div class="info" id="info">Panah / WASD untuk bergerak ‚Ä¢ Tombol Space untuk pause ‚Ä¢ Tombol R untuk reset</div>
    </div>

    <div class="controls">
      <label for="colorSelect">Warna Cacing</label>
      <select id="colorSelect">
        <option value="#10b981">Hijau</option>
        <option value="#ef4444">Merah</option>
        <option value="#3b82f6">Biru</option>
        <option value="#f97316">Oranye</option>
        <option value="#8b5cf6">Ungu</option>
        <option value="rainbow">Rainbow (berganti setiap detik)</option>
      </select>

      <div class="row">
        <button id="startBtn" class="btn small">Mulai</button>
        <button id="resetBtn" class="small">Reset</button>
      </div>

      <label for="speed">Kecepatan</label>
      <input type="range" id="speed" min="4" max="18" value="10" />

      <div style="margin-top:12px">
        <label>Skor</label>
        <div id="score" style="font-size:20px;font-weight:700">0</div>
      </div>

      <div style="margin-top:12px">
        <label>Petunjuk</label>
        <div style="font-size:13px;opacity:0.9">Permen akan muncul acak di area. Jika permenn dimakan, cacing bertambah 1 segmen. Warna "Rainbow" akan berubah setiap 1 detik.
        </div>
      </div>
    </div>

    <div class="footer">Dibuat otomatis ‚Äî tekan Start untuk memulai</div>
  </div>

  <script>
    // Elemen
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const colorSelect = document.getElementById('colorSelect');
    const speedInput = document.getElementById('speed');
    const scoreEl = document.getElementById('score');
    const themeBtn = document.getElementById('themeBtn');
    const body = document.body;
    const sky = document.getElementById('sky');

    // Game config
    const size = 20; // grid per row/col
    const canvasSize = canvas.width; // square
    const cell = canvasSize / size;

    let snake = [{x:10,y:10},{x:9,y:10},{x:8,y:10}];
    let dir = {x:1,y:0};
    let candy = null;
    let running = false;
    let score = 0;
    let tickInterval = null;
    let rainbowInterval = null;
    let currentColor = colorSelect.value;

    function placeCandy(){
      while(true){
        const p = {x: Math.floor(Math.random()*size), y: Math.floor(Math.random()*size)};
        if(!snake.some(s=>s.x===p.x && s.y===p.y)) { candy = p; break }
      }
    }

    function drawCell(x,y,fill,stroke){
      ctx.fillStyle = fill;
      ctx.fillRect(x*cell+1,y*cell+1,cell-2,cell-2);
      if(stroke){ ctx.strokeStyle = stroke; ctx.strokeRect(x*cell+1,y*cell+1,cell-2,cell-2); }
    }

    function draw(){
      // background
      ctx.clearRect(0,0,canvasSize,canvasSize);
      // grid background subtle
      ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--panel').trim() || '#fff';
      ctx.fillRect(0,0,canvasSize,canvasSize);

      // candy
      if(candy) drawCell(candy.x,candy.y,'#f43f5e',null);

      // snake
      let color = currentColor;
      if(color === 'rainbow') color = getRainbow();

      for(let i=0;i<snake.length;i++){
        const s = snake[i];
        if(i===0){ // head
          drawCell(s.x,s.y,shadeColor(color,-12));
        } else {
          drawCell(s.x,s.y,color);
        }
      }
    }

    function shadeColor(hex, percent) {
      // small helper to darken head a little
      if(hex==='rainbow') return '#fff';
      const c = hex.replace('#','');
      const num = parseInt(c,16);
      let r = (num >> 16) + percent;
      let g = ((num >> 8) & 0x00FF) + percent;
      let b = (num & 0x0000FF) + percent;
      r = Math.max(0,Math.min(255,r)); g = Math.max(0,Math.min(255,g)); b = Math.max(0,Math.min(255,b));
      return '#'+(r<<16 | g<<8 | b).toString(16).padStart(6,'0');
    }

    function step(){
      const head = {x: (snake[0].x + dir.x + size) % size, y: (snake[0].y + dir.y + size) % size };
      // collision with self
      if(snake.some(s=>s.x===head.x && s.y===head.y)){
        stopGame();
        alert('Game over! Skor: '+score);
        return;
      }
      snake.unshift(head);
      // eat candy
      if(candy && head.x===candy.x && head.y===candy.y){
        score += 1; scoreEl.textContent = score; placeCandy();
      } else {
        snake.pop();
      }
      draw();
    }

    function startGame(){
      if(running) return;
      running = true;
      if(!candy) placeCandy();
      const fps = Number(speedInput.value);
      const ms = Math.round(1000 / fps * 2); // raw tuning to be playable
      tickInterval = setInterval(step, ms);
      startRainbowIfNeeded();
    }

    function stopGame(){
      running = false;
      clearInterval(tickInterval); tickInterval = null;
      stopRainbow();
    }

    function resetGame(){
      stopGame();
      snake = [{x:10,y:10},{x:9,y:10},{x:8,y:10}];
      dir = {x:1,y:0};
      candy = null; score = 0; scoreEl.textContent = score; currentColor = colorSelect.value;
      draw();
    }

    // controls
    window.addEventListener('keydown', e=>{
      if(['ArrowUp','w','W'].includes(e.key)) { if(dir.y!==1) dir={x:0,y:-1}; }
      if(['ArrowDown','s','S'].includes(e.key)) { if(dir.y!==-1) dir={x:0,y:1}; }
      if(['ArrowLeft','a','A'].includes(e.key)) { if(dir.x!==1) dir={x:-1,y:0}; }
      if(['ArrowRight','d','D'].includes(e.key)) { if(dir.x!==-1) dir={x:1,y:0}; }
      if(e.code==='Space'){ if(running) stopGame(); else startGame(); }
      if(e.key==='r' || e.key==='R'){ resetGame(); }
    });

    // ui bindings
    startBtn.addEventListener('click', ()=>{ startGame(); });
    resetBtn.addEventListener('click', ()=>{ resetGame(); });
    speedInput.addEventListener('input', ()=>{
      if(running){ stopGame(); startGame(); }
    });
    colorSelect.addEventListener('change', ()=>{
      currentColor = colorSelect.value;
      startRainbowIfNeeded();
      draw();
    });

    // rainbow functions
    const rainbowColors = ['#ef4444','#f97316','#f59e0b','#10b981','#06b6d4','#3b82f6','#8b5cf6'];
    let rainbowIdx=0;
    function getRainbow(){ return rainbowColors[rainbowIdx % rainbowColors.length]; }
    function startRainbowIfNeeded(){
      stopRainbow();
      if(currentColor==='rainbow'){
        rainbowIdx = 0;
        rainbowInterval = setInterval(()=>{ rainbowIdx++; draw(); }, 1000);
      }
    }
    function stopRainbow(){ if(rainbowInterval){ clearInterval(rainbowInterval); rainbowInterval=null; } }

    // theme toggle
    let dark = true;
    function applyTheme(){
      body.setAttribute('data-theme', dark? 'dark':'light');
      if(!dark) sky.classList.add('show-sun'); else sky.classList.remove('show-sun');
    }
    themeBtn.addEventListener('click', ()=>{ dark = !dark; applyTheme(); });

    // initialize
    resetGame();
    applyTheme();
    // draw grid once
    draw();

    // ensure candy spawns when resizing small canvas
    window.addEventListener('resize', ()=>{ draw(); });
  </script>
</body>
</html>